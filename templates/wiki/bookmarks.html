{% block content %}
  <h1>–ú–æ–∏ –∑–∞–∫–ª–∞–¥–∫–∏</h1>
{% if bookmarks %}
  <ul>
    {% for bookmark in bookmarks %}
      <li>
        <h3><a href="{{ bookmark.article.get_absolute_url }}">{{ bookmark.article.title }}</a></h3>
        <p><small>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ bookmark.article.category }} | –î–æ–±–∞–≤–ª–µ–Ω–æ: {{ bookmark.created_at|date:"d.m.Y H:i" }}</small></p>
        <form id="bookmark-form-{{ bookmark.id }}" method="post" action="{% url 'wiki:bookmark_toggle' bookmark.article.slug %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="delete-btn" data-id="{{ bookmark.id }}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </li>
      <hr>
    {% endfor %}
  </ul>
{% else %}
  <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–ª–∞–¥–æ–∫. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π —Å—Ç–∞—Ç—å–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–ª–∞–¥–∫–∏".</p>
{% endif %}
  <p><a href="{% url 'wiki:article_list' %}">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Å—Ç–∞—Ç–µ–π</a></p>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
      const deleteButtons = document.querySelectorAll('.delete-btn');
      
      deleteButtons.forEach(button => {
          button.addEventListener('click', function(e) {
              e.preventDefault();

              const form = this.closest('form');

              fetch(form.action, {
                  method: 'POST',
                  headers: {
                      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                      'Accept': 'application/json',
                  },
              })
              .then(response => response.json())
              .then(data => {
                  if (data.is_bookmarked === false) {
                      const li = this.closest('li');
                      li.remove();
                      if (typeof toastr !== 'undefined') {
                        toastr.success('–ó–∞–∫–ª–∞–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞!');
                    } else {
                        console.error('toastr not loaded');
}
                  }
              })
              .catch(error => {
                  console.error('–û—à–∏–±–∫–∞:', error);
                  alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–∫–ª–∞–¥–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
              });
          });
      });
  });
  </script>

  {% endblock %}